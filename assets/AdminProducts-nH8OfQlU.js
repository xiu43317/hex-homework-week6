import{_ as M,M as V,o as d,c as i,a as t,e as u,v as p,F as m,g,m as L,d as x,t as h,n as k,j as $,i as F,r as f,b as v}from"./index-9vonFVup.js";const P="https://vue3-course-api.hexschool.io/v2",y="rock",I={data(){return{product:{},new:!1}},props:["isNew","tempProduct"],methods:{updateProduct(){this.isNew?this.$http.post(`${P}/api/${y}/admin/product`,{data:this.tempProduct}).then(l=>{alert(l.data.message),this.getProducts(),this.hideModal()}).catch(l=>{alert(l.response.data.message),this.hideModal()}):this.$http.put(`${P}/api/${y}/admin/product/${this.tempProduct.id}`,{data:this.tempProduct}).then(l=>{alert(l.data.message),this.getProducts(),this.hideModal()}).catch(l=>{alert(l.response.data.message)})},createImages(){this.Product.imagesUrl=[],this.Product.imagesUrl.push("")},getProducts(){this.$emit("getProducts")},openModal(){this.product=this.tempProduct,this.myModal.show()},hideModal(){this.myModal.hide()},uploadFile(){const l=this.fileInput.files[0],e=new FormData;e.append("file-to-upload",l),this.$http.post(`${P}/api/${y}/admin/upload`,e).then(n=>{this.Product.imageUrl=n.data.imageUrl}).catch(n=>{alert(n.response.data.message)})},uploadFiles(l){const n=document.querySelectorAll(".uploadImages")[l].files[0],_=new FormData;_.append("file-to-upload",n),this.$http.post(`${P}/api/${y}/admin/upload`,_).then(s=>{this.Product.imagesUrl[l]=s.data.imageUrl}).catch(s=>{alert(s.response.data.message)})}},watch:{isNew(){this.new=this.isNew}},mounted(){this.myModal=new V(this.$refs.Modal,{keyboard:!1,backdrop:"static"})}},A={id:"productModal",ref:"Modal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},T={class:"modal-dialog modal-xl"},D={class:"modal-content border-0"},E={class:"modal-header bg-dark text-white"},G={id:"productModalLabel",class:"modal-title"},B={key:0},S={key:1},q=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),j={class:"modal-body"},z={class:"row"},R={class:"col-sm-4"},H={class:"mb-2"},J={class:"mb-3"},K=t("h3",{class:"mb-3"},"主要圖片",-1),O=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),Q={class:"mb-3"},W=t("label",{for:"formFile",class:"form-label"},"上傳檔案",-1),X=["src"],Y=t("h3",{class:"mb-3"},"多圖新增",-1),Z={key:0},tt={class:"mb-3"},et=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),st=["onUpdate:modelValue"],ot={class:"mb-3"},lt=t("label",{for:"formFile",class:"form-label"},"上傳檔案",-1),dt=["onChange"],it=["src"],nt={key:0},at={key:1},rt={key:1},ct={class:"col-sm-8"},ut={class:"mb-3"},pt=t("label",{for:"title",class:"form-label"},"標題",-1),ht={class:"row"},mt={class:"mb-3 col-md-6"},_t=t("label",{for:"category",class:"form-label"},"分類",-1),bt={class:"mb-3 col-md-6"},gt=t("label",{for:"price",class:"form-label"},"單位",-1),ft={class:"row"},vt={class:"mb-3 col-md-6"},Pt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),yt={class:"mb-3 col-md-6"},Mt=t("label",{for:"price",class:"form-label"},"售價",-1),kt=t("hr",null,null,-1),$t={class:"mb-3"},wt=t("label",{for:"description",class:"form-label"},"產品描述",-1),Ut={class:"mb-3"},xt=t("label",{for:"content",class:"form-label"},"說明內容",-1),Ct={class:"mb-3 row"},Vt={class:"mb-3 col-md-6"},Nt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Lt={class:"mb-3 col-md-6 row"},Ft=t("label",{for:"price",class:"col-sm-3 col-form-label"},"推薦度",-1),It={class:"col-sm-5 mt-1"},At=["onClick"],Tt={key:0},Dt=t("i",{class:"bi bi-star-fill"},null,-1),Et=[Dt],Gt={key:1},Bt=t("i",{class:"bi bi-star"},null,-1),St=[Bt],qt={class:"modal-footer"};function jt(l,e,n,_,s,a){return d(),i("div",A,[t("div",T,[t("div",D,[t("div",E,[t("h5",G,[n.isNew?(d(),i("span",B,"新增產品")):(d(),i("span",S,"編輯產品"))]),q]),t("div",j,[t("div",z,[t("div",R,[t("div",H,[t("div",J,[K,O,u(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":e[0]||(e[0]=o=>s.product.imageUrl=o)},null,512),[[p,s.product.imageUrl]])]),t("div",Q,[W,t("input",{class:"form-control",type:"file",id:"formFile",ref:"formFile",onChange:e[1]||(e[1]=o=>a.uploadFile())},null,544)]),t("img",{class:"img-fluid",src:s.product.imageUrl},null,8,X)]),Y,Array.isArray(s.product.imagesUrl)?(d(),i("div",Z,[(d(!0),i(m,null,g(s.product.imagesUrl,(o,r)=>(d(),i(m,{key:r},[t("div",tt,[et,u(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":b=>s.product.imagesUrl[r]=b},null,8,st),[[p,s.product.imagesUrl[r]]])]),t("div",ot,[lt,t("input",{class:"form-control uploadImages",type:"file",onChange:b=>a.uploadFiles(r)},null,40,dt),t("img",{class:"img-fluid",src:s.product.imagesUrl[r]},null,8,it)])],64))),128)),!s.product.imagesUrl.length||s.product.imagesUrl[s.product.imagesUrl.length-1]?(d(),i("div",nt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[2]||(e[2]=o=>s.product.imagesUrl.push(""))}," 新增圖片 ")])):(d(),i("div",at,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:e[3]||(e[3]=o=>s.product.imagesUrl.pop())}," 刪除圖片 ")]))])):(d(),i("div",rt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[4]||(e[4]=o=>a.createImages())}," 新增圖片 ")]))]),t("div",ct,[t("div",ut,[pt,u(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[5]||(e[5]=o=>s.product.title=o)},null,512),[[p,s.product.title]])]),t("div",ht,[t("div",mt,[_t,u(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":e[6]||(e[6]=o=>s.product.category=o)},null,512),[[p,s.product.category]])]),t("div",bt,[gt,u(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":e[7]||(e[7]=o=>s.product.unit=o)},null,512),[[p,s.product.unit]])])]),t("div",ft,[t("div",vt,[Pt,u(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":e[8]||(e[8]=o=>s.product.origin_price=o)},null,512),[[p,s.product.origin_price,void 0,{number:!0}]])]),t("div",yt,[Mt,u(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":e[9]||(e[9]=o=>s.product.price=o)},null,512),[[p,s.product.price,void 0,{number:!0}]])])]),kt,t("div",$t,[wt,u(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":e[10]||(e[10]=o=>s.product.description=o)},`\r
                `,512),[[p,s.product.description]])]),t("div",Ut,[xt,u(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":e[11]||(e[11]=o=>s.product.content=o)},`\r
                `,512),[[p,s.product.content]])]),t("div",Ct,[t("div",Vt,[u(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[12]||(e[12]=o=>s.product.is_enabled=o)},null,512),[[L,s.product.is_enabled]]),Nt]),t("div",Lt,[Ft,t("div",It,[(d(),i(m,null,g(5,(o,r)=>t("a",{href:"#",key:r,onClick:b=>s.product.stars=r+1},[r+1<=n.tempProduct.stars?(d(),i("span",Tt,Et)):(d(),i("span",Gt,St))],8,At)),64))])])])])])]),t("div",qt,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[13]||(e[13]=o=>a.hideModal())}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:e[14]||(e[14]=o=>a.updateProduct())}," 確認 ")])])])],512)}const zt=M(I,[["render",jt]]),Rt=import.meta.VITE_APP_API_URL,Ht=import.meta.VITE_APP_API_NAME,Jt={data(){return{delModal:""}},props:["product"],methods:{deleteProduct(){this.$http.delete(`${Rt}/api/${Ht}/admin/product/${this.product.id}`).then(l=>{alert(l.data.message),this.hideModal(),this.getProducts()}).catch(l=>{alert(l.response.data.message),this.hideModal()})},getProducts(){this.$emit("getProducts")},openModal(){this.delModal.show()},hideModal(){this.delModal.hide()}},mounted(){this.delModal=new V(document.querySelector("#delProductModal"))}},Kt={id:"delProductModal",ref:"delProductModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},Ot={class:"modal-dialog"},Qt={class:"modal-content border-0"},Wt=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Xt={class:"modal-body"},Yt={class:"text-danger"},Zt={class:"modal-footer"};function te(l,e,n,_,s,a){return d(),i("div",Kt,[t("div",Ot,[t("div",Qt,[Wt,t("div",Xt,[x(" 是否刪除 "),t("strong",Yt,h(n.product.title),1),x(" 商品(刪除後將無法恢復)。 ")]),t("div",Zt,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[0]||(e[0]=o=>a.hideModal())}," 取消 "),t("button",{type:"button",class:"btn btn-danger",onClick:e[1]||(e[1]=o=>a.deleteProduct())}," 確認刪除 ")])])])],512)}const ee=M(Jt,[["render",te]]),se={data(){return{}},methods:{emitPage(l){this.$emit("emit-page",l)}},props:["pages"]},oe={key:0,"aria-label":"Page navigation example"},le={class:"pagination"},de=t("span",{"aria-hidden":"true"},"«",-1),ie=[de],ne={key:0,class:"page-link"},ae=["onClick"],re=t("span",{"aria-hidden":"true"},"»",-1),ce=[re];function ue(l,e,n,_,s,a){return n.pages.total_pages?(d(),i("nav",oe,[t("ul",le,[t("li",{class:k(["page-item",{disabled:n.pages.current_page===1}])},[t("a",{class:"page-link",href:"#","aria-label":"Previous",onClick:e[0]||(e[0]=$(o=>a.emitPage(n.pages.current_page-1),["prevent"]))},ie)],2),(d(!0),i(m,null,g(n.pages.total_pages,(o,r)=>(d(),i("li",{class:k(["page-item",{active:o===n.pages.current_page}]),key:r},[o===n.pages.current_page?(d(),i("a",ne,h(o),1)):(d(),i("a",{key:1,class:"page-link",href:"#",onClick:$(b=>a.emitPage(o),["prevent"])},h(o),9,ae))],2))),128)),t("li",{class:k(["page-item",{disabled:n.pages.current_page===n.pages.total_pages}])},[t("a",{class:"page-link",href:"#","aria-label":"Next",onClick:e[1]||(e[1]=$(o=>a.emitPage(n.pages.current_page+1),["prevent"]))},ce)],2)])])):F("",!0)}const pe=M(se,[["render",ue]]),C="https://vue3-course-api.hexschool.io/v2",he="rock",me={data(){return{products:[],isNew:!0,pagination:{},tempProduct:{imagesUrl:[]},editModal:"",delModel:"",isLoading:!1}},methods:{checkLogin(){this.$http.post(`${C}/api/user/check`).then(l=>{this.getProducts()}).catch(l=>{this.$router.push("/login")})},getProducts(l=1){this.isLoading=!0,this.$http.get(`${C}/api/${he}/admin/products?page=${l}`).then(e=>{this.products=e.data.products,this.pagination=e.data.pagination,this.isLoading=!1}).catch(e=>{console.dir(e),this.isLoading=!1})},openModal(l,e={}){l==="new"?(this.tempProduct={imagesUrl:[]},this.isNew=!0,setTimeout(()=>{this.$refs.productModal.openModal()},500)):l==="edit"?(this.tempProduct={...e},this.isNew=!1,setTimeout(()=>{this.$refs.productModal.openModal()},500)):l==="delete"&&(this.tempProduct=e,setTimeout(()=>{this.$refs.delProductModal.openModal()},500))}},mounted(){this.getProducts(),this.editModal=this.$refs.productModal,this.delModel=this.$refs.delProductModal},components:{editProduct:zt,deleteProduct:ee,adminPagination:pe}},_e=t("div",{class:"h3 text-center mt-4"},"後台產品列表",-1),be={class:"container"},ge={class:"text-end mt-4"},fe={class:"table mt-4"},ve=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"150"},"商品推薦"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),Pe={key:0},ye=t("i",{class:"bi bi-star-fill"},null,-1),Me=[ye],ke={key:1},$e=t("i",{class:"bi bi-star"},null,-1),we=[$e],Ue={class:"text-end"},xe={class:"text-end"},Ce={key:0,class:"text-success"},Ve={key:1},Ne={class:"btn-group"},Le=["onClick"],Fe=["onClick"];function Ie(l,e,n,_,s,a){const o=f("myLoading"),r=f("edit-product"),b=f("delete-product"),N=f("admin-pagination");return d(),i(m,null,[v(o,{active:s.isLoading},null,8,["active"]),_e,t("div",be,[t("div",ge,[t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=c=>a.openModal("new"))}," 建立新的產品 ")]),t("table",fe,[ve,t("tbody",null,[(d(!0),i(m,null,g(s.products,c=>(d(),i("tr",{key:c.id},[t("td",null,h(c.category),1),t("td",null,h(c.title),1),t("td",null,[(d(),i(m,null,g(5,(w,U)=>t("span",{key:U},[U+1<=c.stars?(d(),i("span",Pe,Me)):(d(),i("span",ke,we))])),64))]),t("td",Ue,h(c.origin_price),1),t("td",xe,h(c.price),1),t("td",null,[c.is_enabled?(d(),i("span",Ce,"啟用")):(d(),i("span",Ve,"未啟用"))]),t("td",null,[t("div",Ne,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:w=>a.openModal("edit",c)}," 編輯 ",8,Le),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:w=>a.openModal("delete",c)}," 刪除 ",8,Fe)])])]))),128))])]),v(r,{"is-new":s.isNew,"temp-product":s.tempProduct,onGetProducts:a.getProducts,ref:"productModal"},null,8,["is-new","temp-product","onGetProducts"]),v(b,{product:s.tempProduct,onGetProducts:a.getProducts,ref:"delProductModal"},null,8,["product","onGetProducts"]),v(N,{pages:s.pagination,onEmitPage:a.getProducts,ref:"pagination"},null,8,["pages","onEmitPage"])])],64)}const Te=M(me,[["render",Ie]]);export{Te as default};
