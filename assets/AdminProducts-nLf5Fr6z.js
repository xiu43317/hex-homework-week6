import{_ as w,M as N,r as f,o as d,c as i,a as t,e as p,v as m,F as g,g as P,q as F,j as k,b as h,d as C,t as _,n as $,i as I}from"./index-mnxqrXM4.js";const y="https://vue3-course-api.hexschool.io/v2",M="rock",A={data(){return{product:{},new:!1}},props:["isNew","tempProduct"],methods:{updateProduct(){this.isNew?this.$http.post(`${y}/api/${M}/admin/product`,{data:this.tempProduct}).then(s=>{alert(s.data.message),this.getProducts(),this.hideModal()}).catch(s=>{alert(s.response.data.message),this.hideModal()}):this.$http.put(`${y}/api/${M}/admin/product/${this.tempProduct.id}`,{data:this.tempProduct}).then(s=>{alert(s.data.message),this.getProducts(),this.hideModal()}).catch(s=>{alert(s.response.data.message)})},createImages(){this.Product.imagesUrl=[],this.Product.imagesUrl.push("")},getProducts(){this.$emit("getProducts")},openModal(){this.product=this.tempProduct,this.myModal.show()},hideModal(){this.myModal.hide()},uploadFile(){const s=this.fileInput.files[0],e=new FormData;e.append("file-to-upload",s),this.$http.post(`${y}/api/${M}/admin/upload`,e).then(n=>{this.Product.imageUrl=n.data.imageUrl}).catch(n=>{alert(n.response.data.message)})},uploadFiles(s){const n=document.querySelectorAll(".uploadImages")[s].files[0],b=new FormData;b.append("file-to-upload",n),this.$http.post(`${y}/api/${M}/admin/upload`,b).then(o=>{this.Product.imagesUrl[s]=o.data.imageUrl}).catch(o=>{alert(o.response.data.message)})}},watch:{isNew(){this.new=this.isNew}},mounted(){this.myModal=new N(this.$refs.Modal,{keyboard:!1})}},T={id:"productModal",ref:"Modal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},D={class:"modal-dialog modal-xl"},E={class:"modal-content border-0"},G={class:"modal-header bg-dark text-white"},q={id:"productModalLabel",class:"modal-title"},B={key:0},S={key:1},j=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),z={class:"modal-body"},R={class:"row"},H={class:"col-sm-4"},J={class:"mb-2"},K={class:"mb-3"},O=t("h3",{class:"mb-3"},"主要圖片",-1),Q=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),W={class:"mb-3"},X=t("label",{for:"formFile",class:"form-label"},"上傳檔案",-1),Y=["src"],Z=t("h3",{class:"mb-3"},"多圖新增",-1),tt={key:0},et={class:"mb-3"},ot=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),st=["onUpdate:modelValue"],lt={class:"mb-3"},dt=t("label",{for:"formFile",class:"form-label"},"上傳檔案",-1),it=["onChange"],nt=["src"],at={key:0},rt={key:1},ct={key:1},ut={class:"col-sm-8"},pt={class:"mb-3"},mt=t("label",{for:"title",class:"form-label"},"標題",-1),ht={class:"row"},_t={class:"mb-3 col-md-6"},gt=t("label",{for:"category",class:"form-label"},"分類",-1),bt={class:"mb-3 col-md-6"},ft=t("label",{for:"price",class:"form-label"},"單位",-1),vt={class:"row"},Pt={class:"mb-3 col-md-6"},yt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),Mt={class:"mb-3 col-md-6"},kt=t("label",{for:"price",class:"form-label"},"售價",-1),wt=t("hr",null,null,-1),$t={class:"mb-3"},Ut=t("label",{for:"description",class:"form-label"},"產品描述",-1),xt={class:"mb-3"},Ct=t("label",{for:"content",class:"form-label"},"說明內容",-1),Vt={class:"mb-3 row"},Nt={class:"mb-3 col-md-6"},Lt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Ft={class:"mb-3 col-md-6 row"},It=t("label",{for:"price",class:"col-sm-3 col-form-label"},"推薦度",-1),At={class:"col-sm-5 mt-1"},Tt=["onClick"],Dt={key:0},Et={key:1},Gt={class:"modal-footer"};function qt(s,e,n,b,o,a){const r=f("font-awesome-icon");return d(),i("div",T,[t("div",D,[t("div",E,[t("div",G,[t("h5",q,[n.isNew?(d(),i("span",B,"新增產品")):(d(),i("span",S,"編輯產品"))]),j]),t("div",z,[t("div",R,[t("div",H,[t("div",J,[t("div",K,[O,Q,p(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":e[0]||(e[0]=l=>o.product.imageUrl=l)},null,512),[[m,o.product.imageUrl]])]),t("div",W,[X,t("input",{class:"form-control",type:"file",id:"formFile",ref:"formFile",onChange:e[1]||(e[1]=l=>a.uploadFile())},null,544)]),t("img",{class:"img-fluid",src:o.product.imageUrl},null,8,Y)]),Z,Array.isArray(o.product.imagesUrl)?(d(),i("div",tt,[(d(!0),i(g,null,P(o.product.imagesUrl,(l,c)=>(d(),i(g,{key:c},[t("div",et,[ot,p(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":v=>o.product.imagesUrl[c]=v},null,8,st),[[m,o.product.imagesUrl[c]]])]),t("div",lt,[dt,t("input",{class:"form-control uploadImages",type:"file",onChange:v=>a.uploadFiles(c)},null,40,it),t("img",{class:"img-fluid",src:o.product.imagesUrl[c]},null,8,nt)])],64))),128)),!o.product.imagesUrl.length||o.product.imagesUrl[o.product.imagesUrl.length-1]?(d(),i("div",at,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[2]||(e[2]=l=>o.product.imagesUrl.push(""))}," 新增圖片 ")])):(d(),i("div",rt,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:e[3]||(e[3]=l=>o.product.imagesUrl.pop())}," 刪除圖片 ")]))])):(d(),i("div",ct,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[4]||(e[4]=l=>a.createImages())}," 新增圖片 ")]))]),t("div",ut,[t("div",pt,[mt,p(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[5]||(e[5]=l=>o.product.title=l)},null,512),[[m,o.product.title]])]),t("div",ht,[t("div",_t,[gt,p(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":e[6]||(e[6]=l=>o.product.category=l)},null,512),[[m,o.product.category]])]),t("div",bt,[ft,p(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":e[7]||(e[7]=l=>o.product.unit=l)},null,512),[[m,o.product.unit]])])]),t("div",vt,[t("div",Pt,[yt,p(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":e[8]||(e[8]=l=>o.product.origin_price=l)},null,512),[[m,o.product.origin_price,void 0,{number:!0}]])]),t("div",Mt,[kt,p(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":e[9]||(e[9]=l=>o.product.price=l)},null,512),[[m,o.product.price,void 0,{number:!0}]])])]),wt,t("div",$t,[Ut,p(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":e[10]||(e[10]=l=>o.product.description=l)},`\r
                `,512),[[m,o.product.description]])]),t("div",xt,[Ct,p(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":e[11]||(e[11]=l=>o.product.content=l)},`\r
                `,512),[[m,o.product.content]])]),t("div",Vt,[t("div",Nt,[p(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[12]||(e[12]=l=>o.product.is_enabled=l)},null,512),[[F,o.product.is_enabled]]),Lt]),t("div",Ft,[It,t("div",At,[(d(),i(g,null,P(5,(l,c)=>t("a",{href:"#",key:c,onClick:k(v=>o.product.stars=c+1,["prevent"])},[c+1<=n.tempProduct.stars?(d(),i("span",Dt,[h(r,{icon:["fas","star"]})])):(d(),i("span",Et,[h(r,{icon:["far","star"]})]))],8,Tt)),64))])])])])])]),t("div",Gt,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[13]||(e[13]=l=>a.hideModal())}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:e[14]||(e[14]=l=>a.updateProduct())}," 確認 ")])])])],512)}const Bt=w(A,[["render",qt]]),St=import.meta.VITE_APP_API_URL,jt=import.meta.VITE_APP_API_NAME,zt={data(){return{delModal:""}},props:["product"],methods:{deleteProduct(){this.$http.delete(`${St}/api/${jt}/admin/product/${this.product.id}`).then(s=>{alert(s.data.message),this.hideModal(),this.getProducts()}).catch(s=>{alert(s.response.data.message),this.hideModal()})},getProducts(){this.$emit("getProducts")},openModal(){this.delModal.show()},hideModal(){this.delModal.hide()}},mounted(){this.delModal=new N(document.querySelector("#delProductModal"))}},Rt={id:"delProductModal",ref:"delProductModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},Ht={class:"modal-dialog"},Jt={class:"modal-content border-0"},Kt=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Ot={class:"modal-body"},Qt={class:"text-danger"},Wt={class:"modal-footer"};function Xt(s,e,n,b,o,a){return d(),i("div",Rt,[t("div",Ht,[t("div",Jt,[Kt,t("div",Ot,[C(" 是否刪除 "),t("strong",Qt,_(n.product.title),1),C(" 商品(刪除後將無法恢復)。 ")]),t("div",Wt,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[0]||(e[0]=r=>a.hideModal())}," 取消 "),t("button",{type:"button",class:"btn btn-danger",onClick:e[1]||(e[1]=r=>a.deleteProduct())}," 確認刪除 ")])])])],512)}const Yt=w(zt,[["render",Xt]]),Zt={data(){return{}},methods:{emitPage(s){this.$emit("emit-page",s)}},props:["pages"]},te={key:0,"aria-label":"Page navigation example"},ee={class:"pagination"},oe=t("span",{"aria-hidden":"true"},"«",-1),se=[oe],le={key:0,class:"page-link"},de=["onClick"],ie=t("span",{"aria-hidden":"true"},"»",-1),ne=[ie];function ae(s,e,n,b,o,a){return n.pages.total_pages?(d(),i("nav",te,[t("ul",ee,[t("li",{class:$(["page-item",{disabled:n.pages.current_page===1}])},[t("a",{class:"page-link",href:"#","aria-label":"Previous",onClick:e[0]||(e[0]=k(r=>a.emitPage(n.pages.current_page-1),["prevent"]))},se)],2),(d(!0),i(g,null,P(n.pages.total_pages,(r,l)=>(d(),i("li",{class:$(["page-item",{active:r===n.pages.current_page}]),key:l},[r===n.pages.current_page?(d(),i("a",le,_(r),1)):(d(),i("a",{key:1,class:"page-link",href:"#",onClick:k(c=>a.emitPage(r),["prevent"])},_(r),9,de))],2))),128)),t("li",{class:$(["page-item",{disabled:n.pages.current_page===n.pages.total_pages}])},[t("a",{class:"page-link",href:"#","aria-label":"Next",onClick:e[1]||(e[1]=k(r=>a.emitPage(n.pages.current_page+1),["prevent"]))},ne)],2)])])):I("",!0)}const re=w(Zt,[["render",ae]]),V="https://vue3-course-api.hexschool.io/v2",ce="rock",ue={data(){return{products:[],isNew:!0,pagination:{},tempProduct:{imagesUrl:[]},editModal:"",delModel:"",isLoading:!1}},methods:{checkLogin(){this.$http.post(`${V}/api/user/check`).then(s=>{this.getProducts()}).catch(s=>{this.$router.push("/login")})},getProducts(s=1){this.isLoading=!0,this.$http.get(`${V}/api/${ce}/admin/products?page=${s}`).then(e=>{this.products=e.data.products,this.pagination=e.data.pagination,this.isLoading=!1}).catch(e=>{console.dir(e),this.isLoading=!1})},openModal(s,e={}){s==="new"?(this.tempProduct={imagesUrl:[]},this.isNew=!0,setTimeout(()=>{this.$refs.productModal.openModal()},500)):s==="edit"?(this.tempProduct={...e},this.isNew=!1,setTimeout(()=>{this.$refs.productModal.openModal()},500)):s==="delete"&&(this.tempProduct=e,setTimeout(()=>{this.$refs.delProductModal.openModal()},500))}},mounted(){this.getProducts(),this.editModal=this.$refs.productModal,this.delModel=this.$refs.delProductModal},components:{editProduct:Bt,deleteProduct:Yt,adminPagination:re}},pe=t("div",{class:"h3 text-center mt-4"},"後台產品列表",-1),me={class:"container"},he={class:"text-end mt-4"},_e={class:"table mt-4"},ge=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"150"},"商品推薦"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),be={key:0},fe={key:1},ve=t("i",{class:"far fa-star"},null,-1),Pe=[ve],ye={class:"text-end"},Me={class:"text-end"},ke={key:0,class:"text-success"},we={key:1},$e={class:"btn-group"},Ue=["onClick"],xe=["onClick"];function Ce(s,e,n,b,o,a){const r=f("myLoading"),l=f("font-awesome-icon"),c=f("edit-product"),v=f("delete-product"),L=f("admin-pagination");return d(),i(g,null,[h(r,{active:o.isLoading},null,8,["active"]),pe,t("div",me,[t("div",he,[t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=u=>a.openModal("new"))}," 建立新的產品 ")]),t("table",_e,[ge,t("tbody",null,[(d(!0),i(g,null,P(o.products,u=>(d(),i("tr",{key:u.id},[t("td",null,_(u.category),1),t("td",null,_(u.title),1),t("td",null,[(d(),i(g,null,P(5,(U,x)=>t("span",{key:x},[x+1<=u.stars?(d(),i("span",be,[h(l,{icon:"fas fa-star"})])):(d(),i("span",fe,Pe))])),64))]),t("td",ye,_(u.origin_price),1),t("td",Me,_(u.price),1),t("td",null,[u.is_enabled?(d(),i("span",ke,"啟用")):(d(),i("span",we,"未啟用"))]),t("td",null,[t("div",$e,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:U=>a.openModal("edit",u)}," 編輯 ",8,Ue),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:U=>a.openModal("delete",u)}," 刪除 ",8,xe)])])]))),128))])]),h(c,{"is-new":o.isNew,"temp-product":o.tempProduct,onGetProducts:a.getProducts,ref:"productModal"},null,8,["is-new","temp-product","onGetProducts"]),h(v,{product:o.tempProduct,onGetProducts:a.getProducts,ref:"delProductModal"},null,8,["product","onGetProducts"]),h(L,{pages:o.pagination,onEmitPage:a.getProducts,ref:"pagination"},null,8,["pages","onEmitPage"])])],64)}const Ne=w(ue,[["render",Ce]]);export{Ne as default};
