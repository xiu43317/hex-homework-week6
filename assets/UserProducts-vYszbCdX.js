import{_ as M,M as C,r as u,o as h,c as p,a as t,t as d,e as _,v as x,n as b,f as v,b as c,d as L,F as $,g as P,h as w}from"./index-qDws9_t2.js";const U={template:"#userProductModal",data(){return{modal:"",qty:1,isLoading:!1}},props:["product"],methods:{openModal(){this.qty=1,this.modal.show()},closeModal(){this.modal.hide()},updateQty(){this.$emit("update",this.product,this.qty)}},mounted(){this.modal=new C(this.$refs.modal,{keyboard:!1})}},T={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},V={class:"modal-dialog modal-xl",role:"document"},z={class:"modal-content border-0"},B={class:"modal-header bg-dark text-white"},D={class:"modal-title",id:"exampleModalLabel"},N=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Q={class:"modal-body"},S={class:"row"},F={class:"col-sm-6"},I=["src"],q={class:"col-sm-6"},E={class:"badge bg-primary rounded-pill"},j={class:"h5"},A={class:"h6"},G={class:"h5"},H={class:"input-group"};function J(s,o,e,n,i,l){const g=u("font-awesome-icon");return h(),p("div",T,[t("div",V,[t("div",z,[t("div",B,[t("h5",D,[t("span",null,d(e.product.title),1)]),N]),t("div",Q,[t("div",S,[t("div",F,[t("img",{class:"img-fluid",src:e.product.imageUrl,alt:""},null,8,I)]),t("div",q,[t("span",E,d(e.product.category),1),t("p",null,"商品描述："+d(e.product.description),1),t("p",null,"商品內容："+d(e.product.content),1),t("div",j,d(e.product.origin_price)+" 元",1),t("del",A,"原價 "+d(e.product.origin_price)+" 元",1),t("div",G,"現在只要 "+d(e.product.price)+" 元",1),t("div",null,[t("div",H,[_(t("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":o[0]||(o[0]=r=>i.qty=r)},null,512),[[x,i.qty]]),t("button",{type:"button",class:b(["btn btn-primary",{disabled:i.isLoading}]),onClick:o[1]||(o[1]=r=>l.updateQty())},[_(c(g,{icon:"spinner",class:"fa-spin"},null,512),[[v,i.isLoading]]),L(" 加入購物車 ")],2)])])])])])])])],512)}const K=M(U,[["render",J]]),m="https://vue3-course-api.hexschool.io/v2",f="rock",O={data(){return{cart:[],products:[],tempProduct:{},isLoading:!0,isDiscount:!1}},components:{UserProductModal:K},methods:{getProducts(){this.$http.get(`${m}/api/${f}/products/`).then(s=>{this.products=s.data.products;for(let o=0;o<this.products.length;o++)this.products[o].isLoading=!1,this.products[o].checkLoading=!1;this.isLoading=!1}).catch(s=>{console.dir(s),alert(s.data.message),this.isLoading=!1})},updateCart(s,o){this.$http.post(`${m}/api/${f}/cart`,{data:{product_id:s.id,qty:o}}).then(e=>{this.$refs.userProductModal.isLoading=!1,this.products.filter(n=>n.isLoading=!1),alert(s.title+e.data.message),this.$refs.userProductModal.closeModal(),this.getCart()}).catch(e=>{alert(e.message),this.$refs.userProductModal.isLoading=!1,this.products.filter(n=>n.isLoading=!1)})},addToCart(s,o=0){o===0?s.isLoading=!0:this.$refs.userProductModal.isLoading=!0;const e=this.cart.carts.findIndex(n=>n.id===s.id);if(e!==-1&&o!==0)this.updateCart(s,o);else if(e!==-1&&o===0){const n=this.cart[e].qty+=1;this.updateCart(s,n)}else e===-1&&o===0?this.updateCart(s,1):this.updateCart(s,o)},getCart(){this.$http.get(`${m}/api/${f}/cart`).then(s=>{this.cart={...s.data.data};for(let o=0;o<this.cart.carts.length;o++)this.cart.carts[o].cancelLoading=!1}).catch(s=>{alert(s.data.message)})},openModal(s){this.tempProduct=s,s.checkLoading=!0,setTimeout(()=>{this.$refs.userProductModal.openModal(),s.checkLoading=!1},500)}},computed:{},mounted(){this.getProducts(),this.getCart()}},R=t("div",{class:"text-center h3 mb-4"},"產品列表頁面",-1),W={class:"container"},X={class:"table align-middle"},Y=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"商品名稱"),t("th",null,"價格"),t("th")])],-1),Z={style:{width:"200px"}},tt={class:"h5"},st={class:"h6"},ot={class:"h5"},et={class:"btn-group btn-group-sm"},at=["onClick"],dt=["onClick"];function nt(s,o,e,n,i,l){const g=u("myLoading"),r=u("user-product-modal"),y=u("font-awesome-icon");return h(),p($,null,[c(g,{active:i.isLoading},null,8,["active"]),R,c(r,{ref:"userProductModal",product:i.tempProduct,onUpdate:l.addToCart},null,8,["product","onUpdate"]),t("div",W,[t("table",X,[Y,t("tbody",null,[(h(!0),p($,null,P(i.products,a=>(h(),p("tr",{key:a.id},[t("td",Z,[t("div",{alt:"",style:w([{backgroundImage:"url("+a.imageUrl+")"},{height:"100px","background-size":"cover","background-position":"center"}])},null,4)]),t("td",null,d(a.title),1),t("td",null,[t("div",tt,d(a.origin_price)+" 元",1),t("del",st,"原價 "+d(a.origin_price)+" 元",1),t("div",ot,"現在只要 "+d(a.price)+" 元",1)]),t("td",null,[t("div",et,[t("button",{type:"button",class:b(["btn btn-outline-secondary",{disabled:a.checkLoading}]),onClick:k=>l.openModal(a)},[_(c(y,{icon:"spinner",class:"fa-spin"},null,512),[[v,a.checkLoading]]),L(" 查看更多 ")],10,at),t("button",{type:"button",class:b(["btn btn-outline-danger",{disabled:a.isLoading}]),onClick:k=>l.addToCart(a)},[_(c(y,{icon:"spinner",class:"fa-spin"},null,512),[[v,a.isLoading]]),L(" 加到購物車 ")],10,dt)])])]))),128))])])])],64)}const lt=M(O,[["render",nt]]);export{lt as default};
